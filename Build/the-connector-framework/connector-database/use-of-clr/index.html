

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using CLR &mdash; MFSQL Connector 4.10.32.76 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/MFSQL-Favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="M-Files API version and CLR Assembly update" href="../m-files-api-version-and-clr-assembly-update/index.html" />
    <link rel="prev" title="Connector Database" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> MFSQL Connector
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">FAQ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">Frequently asked questions</a></li>
</ul>
<p class="caption"><span class="caption-text">MFSQL Connector Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/index.html">Introduction to MFSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mfsql-data-exchange-and-reporting-connector/index.html">MFSQL Data Exchange and reporting Connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mfsql-integration-connector/index.html">MFSQL Integration Connector</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">The Connector Framework</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../architecture/index.html">Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../connector-content/index.html">Connector Content</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Connector Database</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using CLR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#architecture-of-clr-integration">Architecture of CLR Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-of-clr-in-store-procedures">Application of CLR in store procedures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#benefits-of-using-clr">Benefits of using CLR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#securing-the-use-of-clr">Securing the use of CLR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../m-files-api-version-and-clr-assembly-update/index.html">M-Files API version and CLR Assembly update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#size">Size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#access-security">Access Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#enabling-the-database">Enabling the database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../licensing/index.html">Licensing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/index.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#overview">Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../version-control/index.html">Version Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Blog:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../blogs/index.html">List of blogs</a></li>
</ul>
<p class="caption"><span class="caption-text">SQL Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../procedures/index.html">Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tables/index.html">Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../views/index.html">Views</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MFSQL Connector</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">The Connector Framework</a> &raquo;</li>
        
          <li><a href="../index.html">Connector Database</a> &raquo;</li>
        
      <li>Using CLR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-clr">
<h1>Using CLR<a class="headerlink" href="#using-clr" title="Permalink to this headline">¶</a></h1>
<p>The Connector make extensive use of the <strong>Common Language
Runtime</strong> (<strong>CLR</strong>) as part of its architecture. This virtual machine
component of Microsoft’s .NET framework, manages the execution of .NET
programs. Without CLR it would be impossible to use T-SQL store
procedures to interact with M-Files and perform advanced functions in
the process.</p>
<p>T-SQL is very strong when it comes to manipulating sets of data. CLR is
very strong in other areas, like string and date manipulation, calling
external services. T-SQL stored procedures and CLR stored procedures are
deployed in the Connectors to complement each other - each solving a
specific set of challenges that the other is not particularly good at.</p>
<p>CLR integration feature is off by default in SQL Server, and must be enabled in order to use objects that are implemented using CLR integration. The Connector use CLR as described in Using CLR section.  To enable CLR integration, the <strong>clr
enabled</strong> option of the <strong>sp_configure</strong> stored procedure is set in
the installation scripts.  The following is included in the script
script.update_Assembly.sql.</p>
<p>TRUSTWORTHY will be set ON in order to create assembly with
PERMISSION_SET = UNSAFE.</p>
<p>sp_configure’show advanced options’, 1; GO RECONFIGURE; GO
sp_configure’clr enabled’, 1; GO RECONFIGURE; GO</p>
<p>CLR integration can be disabled by setting the clr enabled option to 0.
When CLR integration is disabled, SQL Server stops executing all CLR
routines and unloads all application domains. The Connector will not
function if CLR is disabled.</p>
<p>Learn more on the use of CLR in the Connector in the following sections</p>
<div class="section" id="architecture-of-clr-integration">
<h2>Architecture of CLR Integration<a class="headerlink" href="#architecture-of-clr-integration" title="Permalink to this headline">¶</a></h2>
<p>The user code runs inside the CLR-hosted environment in SQL Server
(called CLR integration). The following design goals were applied in the
Connector:</p>
<div class="section" id="reliability-safety">
<h3>Reliability (Safety)<a class="headerlink" href="#reliability-safety" title="Permalink to this headline">¶</a></h3>
<p>User code are not allowed to perform operations that compromise the
integrity of the Database Engine process, such as popping a message box
requesting a user response or exiting the process. User code
doesoverwrite theDatabase Engine memory buffers or internal data
structures.</p>
</div>
<div class="section" id="scalability">
<h3>Scalability<a class="headerlink" href="#scalability" title="Permalink to this headline">¶</a></h3>
<p>SQL Server and the CLR have different internal models for scheduling and
memory management. SQL Server supports a cooperative, non-pre-emptive
threading model in which the threads voluntarily yield execution
periodically, or when they are waiting on locks or I/O. The CLR supports
a pre-emptive threading model. If user code running inside SQL Server
can directly call the operating system threading primitives, then it
does not integrate well into the SQL Server task scheduler and can
degrade the scalability of the system. The CLR does not distinguish
between virtual and physical memory, but SQL Server directly manages
physical memory and is required to use physical memory within a
configurable limit.</p>
<p>The architecture have taken scalability of the system into account and
is not compromised by user code calling application programming
interfaces (APIs) for threading, memory, and synchronization primitives
directly.</p>
</div>
<div class="section" id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<p>The managed user code running in the Database Engine have computational
performance comparable to the same code run that outside the server. We
have taken into account that Database access from managed user code is
not as fast as native Transact-SQL and where appropriate use
Transact-SQL.</p>
</div>
<div class="section" id="type-safety-verification">
<h3>Type safety verification<a class="headerlink" href="#type-safety-verification" title="Permalink to this headline">¶</a></h3>
<p>Type-safe code is code that accesses memory structures only in
well-defined ways. For example, given a valid object reference,
type-safe code can access memory at fixed offsets corresponding to
actual field members. However, if the code accesses memory at arbitrary
offsets inside or outside the range of memory that belongs to the
object, then it is not type-safe. When assemblies are loaded in the CLR,
prior to the MSIL being compiled using just-in-time compilation, the
runtime performs a verification phase that examines code to determine
its type-safety. The managed code in the Connector is verifiably
type-safe code.</p>
</div>
<div class="section" id="application-domains">
<h3>Application domains<a class="headerlink" href="#application-domains" title="Permalink to this headline">¶</a></h3>
<p>The CLR supports the notion of application domains as execution zones
within a host process where managed code assemblies can be loaded and
executed. The application domain boundary provides isolation between
assemblies. The assemblies are isolated in terms of visibility of static
variables and data members and the ability to call code dynamically.
Application domains are also the mechanism for loading and unloading
code. Code are unloaded from memory only by unloading the application
domain.</p>
</div>
<div class="section" id="code-access-security-cas">
<h3>Code Access Security(CAS)<a class="headerlink" href="#code-access-security-cas" title="Permalink to this headline">¶</a></h3>
<p>The CLR security system provides a way to control what kinds of
operations managed code can perform by assigning permissions to code.
Code access permissions are assigned based on code identity (for
example, the signature of the assembly or the origin of the code).</p>
<p>The CLR provides for a computer-wide policy that can be set by the
computer administrator. This policy defines the permission grants for
any managed code running on the machine. In addition, there is a
host-level security policy that can be used by hosts such as SQL Server
to specify additional restrictions on managed code.</p>
<p>If a managed API in the .NET Framework exposes operations on resources
that are protected by a code access permission, the API will demand that
permission before accessing the resource. This demand causes the CLR
security system to trigger a comprehensive check of every unit of code
(assembly) in the call stack. Only if the entire call chain has
permission will access to the resource be granted.</p>
</div>
</div>
<div class="section" id="application-of-clr-in-store-procedures">
<h2>Application of CLR in store procedures<a class="headerlink" href="#application-of-clr-in-store-procedures" title="Permalink to this headline">¶</a></h2>
<p>The stored procedures are implemented as public static methods on a
class in the Microsoft .NET Framework assemblies are included in the
Connector. The static method can either be declared as void, or return
an integer value. If it returns an integer value, the integer returned
is treated as the return code from the procedure. For example: EXECUTE
&#64;return_status = procedure_name. The &#64;return_status variable will
contain the value returned by the method. If the method is declared
void, the return code is 0. If the method takes parameters, the number
of parameters in the .NET Framework implementation should be the same as
the number of parameters used in the Transact-SQL declaration of the
stored procedure.</p>
<p>The CLR supplies managed code with services such as cross-language
integration, code access security, object lifetime management, and
debugging and profiling support. Using CLR integration allowed the
Connector to be integrated with stored procedures and can use triggers,
user-defined types, user-defined functions (scalar and table-valued),
and user-defined aggregate functions to perform its functions.</p>
</div>
<div class="section" id="benefits-of-using-clr">
<h2>Benefits of using CLR<a class="headerlink" href="#benefits-of-using-clr" title="Permalink to this headline">¶</a></h2>
<p>Among the major benefits of this integration are:</p>
<ul class="simple">
<li><p><strong>A better programming model</strong>. The .NET Framework languages are in
many respects richer than Transact-SQL, offering constructs and
capabilities previously not available to SQL Server developers. We
can leverage the power of the .NET Framework Library, which provides
an extensive set of classes that can be used to quickly and
efficiently solve programming problems.</p></li>
<li><p><strong>Improved safety and security.</strong> Managed code runs in a common
language run-time environment, hosted by the Database Engine. SQL
Server leverages this to provide a safer and more secure alternative
to the extended stored procedures available in earlier versions of
SQL Server.</p></li>
<li><p><strong>Ability to define data types and aggregate functions.</strong> User
defined types and user defined aggregates are new managed database
objects which expand the storage and querying capabilities of SQL
Server.</p></li>
<li><p><strong>Streamlined development through a standardized
environment.</strong> Database development is integrated into future
releases of the Microsoft Visual Studio .NET development environment.
We use the same tools for developing and debugging database objects
and scripts as the tools that we use to write middle-tier or
client-tier .NET Framework components and services.</p></li>
<li><p><strong>Potential for improved performance and scalability.</strong> In many
situations, the .NET Framework language compilation and execution
models deliver improved performance over Transact-SQL.</p></li>
</ul>
</div>
<div class="section" id="securing-the-use-of-clr">
<h2>Securing the use of CLR<a class="headerlink" href="#securing-the-use-of-clr" title="Permalink to this headline">¶</a></h2>
<p>There are risks associated with the deployment of CLR. We have adopted
safeguarding principles and recommend the following deployment
principles to manage and secure the use of the CLR.</p>
<p>Deploying code into the database is the responsibility of the DBA.
Sometimes CLR code is deployed directly from the external application
into the database. However, the CLR assemblies that is used by the
Connectors is not deployed automatically from the Visual Studio
Environment, but is deployed by the DBA as described later in this
document.</p>
<p>The deployment process allow both the installation and the
upgrade/uninstall of the CLR as a DBA responsibility using standard SQL
procedures.</p>
<div class="section" id="clr-integration-security">
<h3>CLR Integration Security<a class="headerlink" href="#clr-integration-security" title="Permalink to this headline">¶</a></h3>
<p>The security model of the SQL Server integration with CLR manages and
secures access between different types of CLR and non-CLR objects
running within SQL Server. Object external to SQL are called by the
procedures in the Connector. CLR provides for different types of
permissions sets to control the permissions for the assemblies. These
permission sets include SAFE, EXTERNAL_ACCESS and UNSAFE.</p>
<p>Currently the UNSAFE mode is the only method that allows for interacting
with Interop Assemblies with unmanaged code. The Connector use the
M-Files Interop assembly to access M-Files which leaves no alternative
but to deploy the UNSAFE mode for the Connector. However, t he Connector
managed code does not gain access to user data or other user code
exernal to the database except for data in M-Files. The User-defined
code runs under the security context of the user-session that invoked
it, and with the correct privileges for that security context.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../m-files-api-version-and-clr-assembly-update/index.html" class="btn btn-neutral float-right" title="M-Files API version and CLR Assembly update" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="Connector Database" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Laminin Solutions Ltd

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>