

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Working with files &mdash; MFSQL Connector 4.10.32.76 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/MFSQL-Favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Working with aliases" href="../working-with-aliases/index.html" />
    <link rel="prev" title="Send Bulk Email" href="../send-bulk-email/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> MFSQL Connector
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">FAQ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently asked questions</a></li>
</ul>
<p class="caption"><span class="caption-text">MFSQL Connector Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to MFSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mfsql-data-exchange-and-reporting-connector/index.html">MFSQL Data Exchange and reporting Connector</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">MFSQL Integration Connector</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../exploring-metadata/index.html">Exploring metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building-custom-applications-and-integrations/index.html">Building custom applications and integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building-custom-applications-and-integrations/index.html#using-code-on-time">Using Code On Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../property-and-column-usage/index.html">Property and column usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata-search/index.html">Metadata Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create-valuelist-items-from-sql/index.html">Update / Create Valuelist Items from SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-messages/index.html">User Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lookup-views/index.html">Lookup Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../send-bulk-email/index.html">Send Bulk Email</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Working with files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#importing-files-from-explorer">Importing files from explorer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-files-from-a-database">Importing files from a database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exporting-of-files">Exporting of files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-of-preparing-to-export-of-files">Example of preparing to export of Files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../working-with-aliases/index.html">Working with aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correcting-synchronization-errors/index.html">Correcting Synchronization errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../change-of-vault/index.html">Change of Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daily-monthly-routines-for-agents/index.html">Daily Monthly Routines for Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips-and-tricks-on-using-the-connector/index.html">Tips and tricks on using the Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips-and-tricks-on-using-the-connector/index.html#getting-deleted-objects">Getting deleted objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-and-managing-logs/index.html">Using and managing logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working-with-object-version/index.html">Working with Object Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../context-menu-queue/index.html">Context Menu Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../context-menu-queue/index.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../context-menu-queue/index.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../context-menu-queue/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mfsql_connector_addons/index.html">MFSQL Connector addons and utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../users-in-usergroups/index.html">Users in Usergroups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#m-files-external-connectors">M-Files External Connectors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../the-connector-framework/index.html">The Connector Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version-control/index.html">Version Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Blog:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../blogs/index.html">List of blogs</a></li>
</ul>
<p class="caption"><span class="caption-text">SQL Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../procedures/index.html">Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tables/index.html">Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions/index.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views/index.html">Views</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MFSQL Connector</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">MFSQL Integration Connector</a> &raquo;</li>
        
      <li>Working with files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="working-with-files">
<h1>Working with files<a class="headerlink" href="#working-with-files" title="Permalink to this headline">¶</a></h1>
<p>The connector provides a number of different ways to work with the file
documents in M-Files.</p>
<ol class="arabic simple">
<li><p><strong>Import files into M-Files</strong> from another database where the files are stored as blob or from a file location in explorer.</p></li>
<li><p>The primary focus of the connector is to work with the <strong>metadata related to the files</strong>.  The class table has the following columns specifically related to files.</p>
<ul class="simple">
<li><p>SingleFile:  this column show if the object is a single or multi-file object.</p></li>
<li><p>FileCount: This column show the number of files in the multi-file object</p></li>
</ul>
</li>
<li><p><strong>Export of files from M-Files</strong>:  Export files from any class table to a designated folder on the SQL server.  <a class="reference internal" href="../../tables/tbMFExportFileHistory.html"><span class="doc">MFExportFileHistory</span></a> table references the exported files to allow for further processing such as using the files as an attachment to an email.  This functionality can be used to export files to explorer to create an extract of all the files in the vault.</p></li>
<li><p><strong>Use FolderExport v3 for bulk file imports</strong> to generate a CSV file that can be used with M-Files Importing tool to import files and map them to the metadata with the Connector.</p></li>
<li><p><strong>Use the properties related to files</strong> Export files as above and set the IsDownload parameter to 0 to only download file information without downloading the files. The data about the file (extention, file size, name) in the  <a class="reference internal" href="../../tables/tbMFExportFileHistory.html"><span class="doc">MFExportFileHistory</span></a> table can then be used in reporting or analysis</p></li>
</ol>
<div class="section" id="importing-files-from-explorer">
<h2>Importing files from explorer<a class="headerlink" href="#importing-files-from-explorer" title="Permalink to this headline">¶</a></h2>
<p>The main use of this feature is create or update a record in the class
table and associate a file or files from explorer at the same time.</p>
<p>The procedure <a class="reference internal" href="../../procedures/spMFUpdateExplorerFileToMFiles.html"><span class="doc">spMFUpdateExplorerFileToMFiles</span></a> allows for importing a file or files from explorer into M-Files. In simple terms an explorer file is matched with the record in the class table and imported into M-Files. The results are logged in the <a class="reference internal" href="../../tables/tbMFFileImport.html"><span class="doc">MFFileImport</span></a> table</p>
<ul class="simple">
<li><p>The object can be created in M-Files using MFSQL Connector at the same time as importing the file.</p></li>
<li><p>If another file is added to a single file object, it would automatically be converted to a multifile document</p></li>
<li><p>If a file is added to a empty multifile document, it would automatically change it to a single file object.</p></li>
<li><p>The file in M-Files will be overwritten If the file already exists for the specific object</p></li>
</ul>
<p>Prerequisites for the spMFUpdateExplorerFiletoMFiles routine are:</p>
<ul class="simple">
<li><p>New or existing record in Class table - &#64;SQLID parameter refers to the id of the record. The record must pre-exist in the class table.   There is no need to pre-update M-Files with a new record. This routine will automatically create the object in M-Files if it does not exist.</p></li>
<li><p>Filename of the file to be imported - &#64;fileName</p></li>
<li><p>folder path of the file - &#64;Filelocation. This location must be on the SQL server, preferably use the location c:/MFSQL/FileImport with sub folders.</p></li>
<li><p>Class table name - &#64;TableName</p></li>
</ul>
<p>The routine will use the SQL Server security context to access files on the network. It is therefore important to ensure that the SQL Server login has access to the network folders.  Setup the SQL server to login as a service account that has access to the folders.  If the procedure is call by an agent, then the SQL Server agent login account must also have access to the folders. Alternatively certificates and proxies can be used to setup the agent security context.</p>
<p>SpMFUpdateExplorerFiletoMFiles processes one file for one record at a time.  To process a series of files and records one would create a loop to run through all the records and related file references. This can be accomplished in different ways, the choice of which will depend on the source of the files and data to be imported.</p>
<ul class="simple">
<li><p>A Powershell utility for <a class="reference internal" href="../../getting-started/configuration-and-setup/setup-powershell-utilities/index.html"><span class="doc">Setup powershell utilities</span></a>  is available in the addons of MFSQL Connector as FolderExport_v3 to import file and folder data from explorer to CSV or staging tables. This utility exposes the contents of the file system to SQL to get the location of the file and file name for the import routine.</p></li>
<li><p>Sometimes the third party system have a reference to the file and location of the file. this data, combined with the record in the
class table will setup the loop for calling the importing routine.</p></li>
</ul>
<p>The following importing scenarios apply:</p>
<ul>
<li><p>If the file already exist for the object then the existing file in M-Files will be overwritten. M-Files version control will record the prior version of the record.</p></li>
<li><p>If the object is new in the class table (does not yet have a objid and guid) then the object will first be created in M-Files and then the file will be added.</p></li>
<li><p>If the object in M-Files is a multifile document with no files, then the object will be converted to a single file object.</p></li>
<li><p>if the object in M-files already have a file or files, then it would convert to a multifile object and the additional file will be added</p></li>
<li><p>If the filename or location of the file cannot be found, then a error will be added in the filerror column in the MFFileImport Table.</p></li>
<li><p>If the parameter option &#64;IsFileDelete is set to 1, then the originating file will be deleted. The default is to not delete.</p></li>
<li><p>The Importing of files using spMFUpdateExplorerFileToMFiles will list all the files imported, or rejected in the MFMfileImport table. The results of each file import is shown in the column ImportError.</p>
<p><img alt="image0" src="../../_images/img_12.png" /></p>
</li>
</ul>
<p>The following example illustrates importing a single file to an object.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DECLARE</span> <span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="nb">INT</span><span class="p">;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">FileLocation</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;C:\Share\Fileimport\2\&#39;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">FileName</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;CV - Tommy Hart.docx&#39;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">TableName</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;MFOtherDocument&#39;</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">SQLID</span> <span class="nb">INT</span> <span class="o">=</span> <span class="mi">1</span>

 <span class="k">EXEC</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">spMFUpdateExplorerFileToMFiles</span><span class="p">]</span>
 <span class="o">@</span><span class="n">FileName</span> <span class="o">=</span> <span class="o">@</span><span class="n">FileName</span>
 <span class="p">,</span><span class="o">@</span><span class="n">FileLocation</span> <span class="o">=</span> <span class="o">@</span><span class="n">FileLocation</span>
 <span class="p">,</span><span class="o">@</span><span class="n">MFTableName</span> <span class="o">=</span> <span class="o">@</span><span class="n">TableName</span>
 <span class="p">,</span><span class="o">@</span><span class="n">SQLID</span> <span class="o">=</span> <span class="o">@</span><span class="n">SQLID</span>
 <span class="p">,</span><span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="o">=</span> <span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="k">OUTPUT</span>
 <span class="p">,</span><span class="o">@</span><span class="n">Debug</span> <span class="o">=</span> <span class="mi">0</span>
 <span class="p">,</span><span class="o">@</span><span class="n">IsFileDelete</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">MFFileImport</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">mfi</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="importing-files-from-a-database">
<h2>Importing files from a database<a class="headerlink" href="#importing-files-from-a-database" title="Permalink to this headline">¶</a></h2>
<p>In this use case we will illustrate how files in Blobs in a database are imported into M-Files. This use case is applicable in instances where the third party application store files in the database in binary or Blobs formats. This method will allow for a file that is stored in a database that is accessible as a view or table in MFSQL Connector database to be extracted and imported into M-Files.  There is a number of key elements and pre-requisites to set this up.</p>
<blockquote>
<div><ul class="simple">
<li><p>A new text property with the name  Mfsql_File_Unique_Ref is added to the metadata of the target class.  For instance, if image files will be imported into the Drawing Class in M-Files then  Mfsql_File_Unique_Ref must be added in M-Files as a property and added to the Drawing Class in M-Files.</p></li>
<li><p>Note the setting in MFSettings for the location of the temporary folder on the SQL server to be used during the processing of the file transfer.  The procedure will temporarily save the file in this folder, and then use M-Files API’s to import the file into M-Files and link it with the metadata.</p></li>
<li><p>A table or view must exist with the following minimum columns
-  The Image in a blob format. This is usually a data type of bit or nvarchar(max)
-  The name of the file
-  A unique reference for the image</p></li>
<li><p>Add or update the record to be updated in the MFSQL Connector class table by updating the Mfsql_File_Unique_Ref column and any additional metadata to be added / updated for the record. This is usually done by having a select statement with a join between all the related data in the image file database to extract all the relevant data from the third party database. Set the process_id of the table to 6 or higher.</p></li>
<li><p> Execute <a class="reference internal" href="../../procedures/spMFSynchronizeFilesToMFiles.html"><span class="doc">spMFSynchronizeFilesToMFiles</span></a></p>
<ul>
<li><p>if the record in the class table is new, a new single file object will be created in M-Files with the relevant metadata</p></li>
<li><p>if the record exist and the file is new, the record will be set as a multi file document and the new file will be added.  A new file is where name of the file is different from another file in the multi-files of the specific object</p></li>
<li><p>If the record exist and there is already a file in the multi-file document with the same name, then to file in M-Files will be overwritten.</p></li>
</ul>
</li>
<li><p>The procedure will allow for specifying the size of the batches to be imported. This will allow for importing larger volumes of files in segments.</p></li>
</ul>
</div></blockquote>
<p>Following illustrate the code for the process following after the basic installation of MFSQL Connector.</p>
<p>Step 1: Identify the table(s) with the files and related data in the third and create view to access the key columns: unique identifier (e.g. GUID), filename, and file data plus additional information to related to the data. In the example below the accounts and loan data is mapped to the filedata table where the blob is stored</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span><span class="n">scu</span><span class="p">].[</span><span class="n">vw_Filedata</span><span class="p">]</span>
<span class="k">AS</span>

<span class="k">SELECT</span> <span class="n">fd</span><span class="p">.[</span><span class="n">id</span><span class="p">]</span>
     <span class="p">,</span> <span class="n">fd</span><span class="p">.[</span><span class="n">GUID</span><span class="p">]</span>
     <span class="p">,</span> <span class="n">fd</span><span class="p">.[</span><span class="n">FileName</span><span class="p">]</span>
     <span class="p">,</span> <span class="n">fd</span><span class="p">.[</span><span class="n">FileData</span><span class="p">]</span>
     <span class="p">,</span> <span class="n">fd</span><span class="p">.[</span><span class="n">Created</span><span class="p">]</span>
     <span class="p">,</span> <span class="n">fd</span><span class="p">.[</span><span class="n">Modified_on</span><span class="p">]</span>
  <span class="p">,</span><span class="n">xxx</span> <span class="c1">-- All the related columns to the file</span>
    <span class="k">FROM</span> <span class="n">scu</span><span class="p">.</span><span class="n">filedata</span> <span class="n">fd</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="p">[</span><span class="n">scu</span><span class="p">].[</span><span class="n">accounts</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="k">ON</span> <span class="p">[</span><span class="n">a</span><span class="p">].[</span><span class="n">Account_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">fd</span><span class="p">.</span><span class="n">ACCOUNT_ID</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="p">[</span><span class="n">scu</span><span class="p">].[</span><span class="n">Loans</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
<span class="k">ON</span> <span class="p">[</span><span class="n">l</span><span class="p">].[</span><span class="n">Loan_No</span><span class="p">]</span> <span class="o">=</span> <span class="n">fd</span><span class="p">.</span><span class="n">loan_ID</span>

<span class="k">GO</span>
</pre></div>
</div>
<p>Step 2: Identify the target class(es) for the files in M-Files and create class table(s). Then update the records from M-Files for all related data. (e.g. a customer account invoice would at least require the class for invoice documents, and for customers.) In this case we will import files to the Invoices class and update the customers class. Add the property ‘MFSQL_File_Unique_Ref’ to the target document class (Invoice in this case). The property for the unique reference will be used to link the imported file to the object in M-Files</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">EXEC</span> <span class="n">dbo</span><span class="p">.</span><span class="n">spMFCreateTable</span> <span class="s1">&#39;Invoice&#39;</span><span class="p">;</span>
<span class="k">EXEC</span> <span class="n">dbo</span><span class="p">.</span><span class="n">spMFUpdateTable</span> <span class="s1">&#39;MFInvoice&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>Step 3: Use the Connector to add new objects in the class table. Ensure to complete the ‘MFSQL_File_Unique_Ref’ for each record which will contain a file from the external system.  Ensure that the unique reference in the external data and in the object matches. At the same time all the dependent class and valuelist records should also be created updated to complete the updating of the metadata for the file object and its related data from the external system.</p>
<p>To add the unique reference to the class table</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">MFInvoice</span>
<span class="k">ADD</span>  <span class="n">Mfsql_File_Unique_Ref</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>To update the metadata for the Invoice</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dbo</span><span class="p">.</span><span class="n">MFInvoice</span>
<span class="p">(</span>
    <span class="n">Mfsql_File_Unique_Ref</span><span class="p">,</span>
    <span class="n">Keywords</span><span class="p">,</span>
    <span class="n">Name_Or_Title</span><span class="p">,</span>
    <span class="n">Process_ID</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="n">vf</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
       <span class="s1">&#39;InsertFiles&#39;</span><span class="p">,</span>
       <span class="n">vf</span><span class="p">.</span><span class="n">FileName</span><span class="p">,</span>
       <span class="mi">1</span>
<span class="k">FROM</span> <span class="n">Scion32</span><span class="p">.</span><span class="n">scu</span><span class="p">.</span><span class="n">vw_Filedata</span> <span class="k">AS</span> <span class="n">vf</span><span class="p">;</span>

<span class="k">EXEC</span> <span class="n">spmfupdatetable</span> <span class="s1">&#39;MFInvoice&#39;</span><span class="p">,</span><span class="mi">0</span>
</pre></div>
</div>
<p>Step 4: Set the process_id = 6 for records with files.  This is to identify the records in the class to get the file blobs from the external source</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">t</span>
 <span class="k">SET</span> <span class="n">Process_ID</span> <span class="o">=</span> <span class="mi">6</span>
<span class="k">FROM</span> <span class="n">MFInvoice</span> <span class="n">t</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Scion32</span><span class="p">.</span><span class="n">scu</span><span class="p">.</span><span class="n">vw_Filedata</span> <span class="k">AS</span> <span class="n">vf</span>
<span class="k">ON</span> <span class="n">t</span><span class="p">.</span><span class="n">id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">null</span>
</pre></div>
</div>
<p>Step 5: Finally,import the files using the procedure <a class="reference internal" href="../../procedures/spMFSynchronizeFilesToMFiles.html"><span class="doc">spMFSynchronizeFilesToMFiles</span></a>. The import will be performed in batches of 500</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DECLARE</span> <span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="nb">INT</span><span class="p">;</span>
<span class="k">EXEC</span> <span class="n">dbo</span><span class="p">.</span><span class="n">spMFSynchronizeFilesToMFiles</span>
    <span class="o">@</span><span class="n">SourceTableName</span> <span class="o">=</span> <span class="s1">&#39;scion32.scu.vw_Filedata&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="n">FileUniqueKeyColumn</span> <span class="o">=</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="n">FileNameColumn</span> <span class="o">=</span> <span class="s1">&#39;FileName&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="n">FileDataColumn</span> <span class="o">=</span> <span class="s1">&#39;FileData&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="n">MFTableName</span> <span class="o">=</span> <span class="s1">&#39;MFInvoice&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="n">BatchSize</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="o">@</span><span class="n">Process_ID</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="o">=</span> <span class="o">@</span><span class="n">ProcessBatch_id</span> <span class="k">OUTPUT</span><span class="p">,</span>
    <span class="o">@</span><span class="n">Debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="o">@</span><span class="n">TargetFileUniqueKeycolumnName</span> <span class="o">=</span> <span class="s1">&#39;mfsql_File_Unique_ref&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Step 6: view the results in SQL in the table MFFileImport</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">MFFileImport</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name_or_title</span><span class="p">,</span> <span class="n">MFVersion</span><span class="p">,</span> <span class="n">FileCount</span><span class="p">,</span> <span class="n">Single_File</span><span class="p">,</span> <span class="n">Mfsql_File_Unique_Ref</span><span class="p">,</span> <span class="n">Process_ID</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">MFInvoice</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="exporting-of-files">
<h2>Exporting of files<a class="headerlink" href="#exporting-of-files" title="Permalink to this headline">¶</a></h2>
<p>Exporting files with <a class="reference internal" href="../../procedures/spMFExportFiles.html"><span class="doc">spMFExportFiles</span></a> from M-Files allows for extracting files, and information about the files from M-Files into explorer and SQL.  An object in M-Files, including its properties, could have none or multiple files each with its own properties. This capability allows for access these files and properties.</p>
<p>The functionality is designed to address different types of use cases.</p>
<p>Some of these use cases include:</p>
<ul class="simple">
<li><p>Get a file from M-Files and attach it to a database email, and therefore send bulk emails with attachments.</p></li>
<li><p>Move files from one object type to another.</p></li>
<li><p>Move objects from a non document Object type class  to a document type class.  This is particularly useful because one cannot change the class of a non-document object type to a document type class in the user interface.</p></li>
<li><p>Get all the files related to a specific project, customer or event in explorer.</p></li>
<li><p>Compare the versions of files on a checksum level with the same files outside of M-Files. (this use case stems from the need to legally prove that the files in M-Files did not change when compared with the originating files in explorer)</p></li>
<li><p>Export files from M-Files when M-Files are no longer used.</p></li>
<li><p>Use the file data to calculate total number of files, files storage, file of specific type (extention) or other statistics</p></li>
</ul>
<p>In principal this capability centers around matching metadata of objects in a class with the files in the object and making the information related to the objects, and the actual files available outside M-Files.  The related information in SQL is in the class table and <a class="reference internal" href="../../tables/tbMFExportFileHistory.html"><span class="doc">MFExportFileHistory</span></a>.  The files, if downloaded, is in explorer in the folders specified in the parameters.  Some of the use cases will require additional custom procedures or steps to complete the functional process of the use case. The output of this exporting procedure is however a fundamental building block in the process.</p>
<div class="section" id="example-of-preparing-to-export-of-files">
<h3>Example of preparing to export of Files<a class="headerlink" href="#example-of-preparing-to-export-of-files" title="Permalink to this headline">¶</a></h3>
<p>This example use the Sales Invoice class</p>
<p>Step 1 - create class table, review setup for export destinations.  The Root folder is set in the MFSettings table.  The base folder for the class is set in the MFClass table</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span> <span class="k">EXEC</span> <span class="n">spmfcreatetable</span> <span class="s1">&#39;Sales Invoice&#39;</span> <span class="c1">--create table</span>
 <span class="k">EXEC</span> <span class="n">spmfupdatetable</span> <span class="s1">&#39;MFSalesInvoice&#39;</span><span class="p">,</span><span class="mi">1</span>  <span class="c1">--update table</span>

 <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mfsalesinvoice</span> <span class="c1">---review objects in table</span>

 <span class="k">Update</span> <span class="n">mc</span>  <span class="c1">-- update Class table to set a custom folder for sales invoices</span>
 <span class="k">SET</span> <span class="n">FileExportFolder</span> <span class="o">=</span> <span class="s1">&#39;SalesInvoices&#39;</span>
 <span class="k">FROM</span> <span class="n">MFclass</span> <span class="n">mc</span> <span class="k">WHERE</span> <span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;MFSalesInvoice&#39;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mfsettings</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;RootFolder&#39;</span>  <span class="c1">-- review Root folder: all files will be exported to C:\MFSQL\FileExport\ on the SQL server</span>
</pre></div>
</div>
<p>Step 2 - Select the objects to be included in the export.  this could be for a single row, or the whole table.  Note that the column FileCount show if the object have none, or multiple files.  The Column Single_File indicate if the object is a multi document object or not.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span> <span class="n">MFSalesInvoice</span> <span class="c1">--mark records for files to be exported by setting the process_id column</span>
<span class="k">SET</span> <span class="n">process_Id</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">WHERE</span> <span class="n">filecount</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1">--use filters to select the appropriate records.</span>
</pre></div>
</div>
<p>Step 3 - determine the settings for the parameters.  Refer to <a class="reference internal" href="../../procedures/spMFExportFiles.html"><span class="doc">spMFExportFiles</span></a> for more detail about the parameters</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DECLARE</span> <span class="o">@</span><span class="n">ProcessBatch_ID</span> <span class="nb">INT</span><span class="p">;</span>
<span class="k">EXEC</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">spMFExportFiles</span><span class="p">]</span> <span class="o">@</span><span class="n">TableName</span> <span class="o">=</span> <span class="s1">&#39;MFSalesInvoice&#39;</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">PathProperty_L1</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">PathProperty_L2</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">PathProperty_L3</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">IsDownload</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">IncludeDocID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">Process_id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">ProcessBatch_ID</span> <span class="o">=</span> <span class="o">@</span><span class="n">ProcessBatch_ID</span> <span class="k">OUTPUT</span><span class="p">,</span>
                        <span class="o">@</span><span class="n">Debug</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Step 4 - Review the result. <a class="reference internal" href="../../tables/tbMFExportFileHistory.html"><span class="doc">MFExportFileHistory</span></a>  show the output of the process. If &#64;IsDownload = 1 then the files should be in the explorer folders. If &#64;IsDownloaded = 0 then the data will be in the table, but the file will not be in explorer. This is particularly useful if the objective is to perform analysis on the data about the files, rather than accessing the files.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">MFExportFileHistory</span><span class="p">]</span> <span class="k">AS</span> <span class="p">[</span><span class="n">mefh</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../working-with-aliases/index.html" class="btn btn-neutral float-right" title="Working with aliases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../send-bulk-email/index.html" class="btn btn-neutral float-left" title="Send Bulk Email" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Laminin Solutions Ltd

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>